# frozen_string_literal: true

load_environment_file

FRONTEND_ENVIRONMENTS = %W[
  ENVIRONMENT=production
  API_URL=https://#{ENV['API_HOST']}/api/v1
  API_V2_URL=https://#{ENV['APIR_HOST']}/v2
  SENTRY_DSN=#{ENV['SENTRY_DSN']}
].freeze

in_directory(project_path) do
  in_directory('frontend') do
    build_swo_image(
      docker_name_supplement: 'frontend',
      build_args: FRONTEND_ENVIRONMENTS
    )
  end

  in_directory('api') do
    build_swo_image(
      docker_name_supplement: 'api',
      network: 'traefik'
    )
  end
  migrate_swo_laravel_db 'api'

  in_directory('apir') do
    build_swo_image(
      docker_name_supplement: 'apir',
      network: 'traefik'
    ) 
  end
  migrate_swo_rails_db 'apir'

end
